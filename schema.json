{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Automated_SQLi Log Record Schema v1.0",
  "type": "object",
  "required": ["version","timestamp","trace_id","request","response","meta"],
  "additionalProperties": false,
  "properties": {
    "version": {"type":"string","pattern":"^\\d+\\.\\d+$"},
    "timestamp": {"type":"string","format":"date-time"},
    "trace_id": {"type":"string","pattern":"^[0-9a-fA-F\\-]{36}$"},
    "request": {
      "type":"object","required":["method","uri","params","headers","client_ip"],"additionalProperties": false,
      "properties":{
        "method":{"type":"string"},
        "uri":{"type":"string"},
        "params":{"type":"array","items":{"type":"object","required":["name","position"],"additionalProperties":false,"properties":{"name":{"type":"string"},"position":{"type":"integer","minimum":0},"value_hash":{"type":"string"},"value_redacted":{"type":["string","null"]}}}},
        "headers":{"type":"object","additionalProperties":{"type":"string"}},
        "body_snippet":{"type":["string","null"]},
        "client_ip":{"type":"string"}
      }
    },
    "payload":{"type":"object","additionalProperties":false,"properties":{"payload_id":{"type":["string","null"]},"category":{"type":["string","null"]},"vector":{"type":["string","null"]},"template_ref":{"type":["string","null"]},"raw_payload_redacted":{"type":["string","null"]}}},
    "response":{"type":"object","required":["status","size_bytes","content_hash","response_time_ms"],"additionalProperties":false,"properties":{"status":{"type":"integer"},"size_bytes":{"type":"integer","minimum":0},"content_hash":{"type":"string"},"key_substrings":{"type":"array","items":{"type":"string"}},"response_time_ms":{"type":"number","minimum":0},"semantic_diff_score":{"type":"number","minimum":0,"maximum":1}}},
    "db":{"type":["object","null"],"additionalProperties":false,"properties":{"connection_id":{"type":"string"},"normalized_query":{"type":"string"},"query_params_count":{"type":"integer","minimum":0},"execution_time_ms":{"type":"number","minimum":0},"query_plan_id":{"type":"string"}}},
    "outcome":{"type":["object","null"],"additionalProperties":false,"properties":{"success_confidence":{"type":"number","minimum":0,"maximum":1},"data_extracted_count":{"type":"integer","minimum":0},"notes":{"type":"string"}}},
    "meta":{"type":"object","required":["tool","round"],"additionalProperties":false,"properties":{"tool":{"type":"string"},"tool_version":{"type":["string","null"]},"round":{"type":"string"},"annotations":{"type":"array","items":{"type":"string"}}}}
  }
}